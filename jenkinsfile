node{

properties(
[parameters(
[string(defaultValue: '1', description: '', name: 'USERS', trim: false), 
string(defaultValue: '60', description: '',name: 'DURATION', trim: false),
string(defaultValue: '1', description: '', name: 'RAMP_UP', trim: false)])])

 stage("git pull"){
      git branch: 'Performance_task', url: 'https://github.com/BakuBakuChan/tasks'
   }
   stage("Run gatling project"){
      bat label: '', script: '''cd gatling-charts-highcharts-bundle-3.1.2\\bin
      set JAVA_OPTS="-Dusers=%USERS%" "-Dduration=%DURATION%" "-DrampUp=%RAMP_UP%"
      gatling.bat -s testTaskPerformance.MySimulation'''
    }
    stage("Report"){
    publishHTML(
    [allowMissing: false, alwaysLinkToLastBuild: false, 
    keepAll: false, reportDir: 
    'gatling-charts-highcharts-bundle-3.1.2\\results\\mysimulation-20190607121624901\\index.html', 
    reportFiles: 'index.html', reportName: 'Gatling Report', reportTitles: ''])
    }
   stage("Clean work spase"){
      deleteDir()
    }
}
